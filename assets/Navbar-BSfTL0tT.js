import{r as h,j as e,u as H,a as j}from"./index-y6hroLTh.js";import{S as T}from"./moclogo-BnPsLxPu.js";const L=async(t,s,a)=>{let n=[];for(const l of t){const r=`/moc-design-docs/documents/${s}/${l.file}.md`;try{const o=await fetch(r);if(!o.ok)throw new Error(`Failed to fetch ${r}`);const c=await o.text();n.push({fileName:l.file,content:c,type:a})}catch(o){console.error(`Error fetching ${r}:`,o)}if(l.children&&l.children.length>0){const o=await L(l.children,s,a);n=n.concat(o)}}return n},w=async t=>{const s=await fetch(t);if(!s.ok)throw new Error(`Failed to fetch ${t}`);return await s.json()},A=async()=>{const t={documents:"documents",projects:"projects",tutorials:"tutorials"},s="/moc-design-docs/",[a,n,l]=await Promise.all([w(`${s}data/documentStructure.json`),w(`${s}data/projectStructure.json`),w(`${s}data/tutorialStructure.json`)]),i={documents:a,projects:n,tutorials:l};let r=[];for(const o of["documents","projects","tutorials"]){const c=i[o],m=t[o],p=await L(c,m,o);r=r.concat(p)}return r},E=(t,s,a=[])=>{for(const n of t){const l=[...a,n.title];if(n.file===s)return l;if(n.children){const i=E(n.children,s,l);if(i)return i}}return null},y=async t=>{const s=await fetch(t);if(!s.ok)throw new Error(`Failed to fetch ${t}`);return await s.json()},J=async(t,s)=>{let a,n;try{const l="/moc-design-docs/";switch(s){case"documents":a=await y(`${l}data/documentStructure.json`),n="documents";break;case"projects":a=await y(`${l}data/projectStructure.json`),n="projects";break;case"tutorials":a=await y(`${l}data/tutorialStructure.json`),n="tutorials";break;default:return null}const i=E(a,t);return i?{path:i,prefix:n}:null}catch{return null}},W=(t,s)=>{const a=new RegExp(s,"gi"),n=t.toLowerCase().indexOf(s.toLowerCase());if(n===-1)return t;const l=[">","*","#"," ","-","、","[","]","(",")","{","}","|","`","~","!","@","/",'"',"'","\\"],i=g=>g.split("").filter(N=>!l.includes(N)).join("");let r=n,o=0;for(;r>0&&o<10;)r--,l.includes(t[r])||o++;let c=n+s.length;for(o=0;c<t.length&&o<10;)l.includes(t[c])||o++,c++;const m=i(t.slice(r,c)),p=/[\u4e00-\u9fa5]+/g,x=m.match(p);return(x?x.join("").length:0)<6?null:`…${m}…`.replace(a,g=>`<mark>${g}</mark>`)},_=t=>t.replace(/<[^>]*>/g,"").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1"),q=()=>{const[t,s]=h.useState(""),[a,n]=h.useState([]),[l,i]=h.useState(!1),[r,o]=h.useState(!1),[c,m]=h.useState(null),[p,x]=h.useState([]);h.useEffect(()=>{(async()=>{i(!0);const d=await A();x(d),i(!1)})()},[]);const b=h.useCallback(async()=>{if(!t){n([]),i(!1);return}i(!0);const u=[],d={};for(const v of p){const{fileName:f,content:M,type:P}=v,F=_(M).split(`
`),C=await J(f,P),O="/moc-design-docs/";if(C){const{path:I,prefix:R}=C,B=`${O}${R}/${I.join("/")}`;F.forEach($=>{if($.toLowerCase().includes(t.toLowerCase())){if(d[f]||(d[f]=0),d[f]>=2)return;d[f]+=1,u.push({fileName:f,filePath:B,matchedLine:$})}})}}n(u),i(!1)},[p,t]),k=u=>{const d=u.target.value;s(d)};h.useEffect(()=>{t?b():n([])},[t,b]);const S=()=>{s(""),m(null)},g=()=>{if(a.length>0){const u=a[0].filePath;window.location.href=u}},N=()=>{o(!0)},D=()=>{o(!1),m(null)};return e.jsx("div",{className:`header-search ${a.length>0?"has-search-results":""}`,children:e.jsxs("form",{action:"/zh-CN/search",className:"search-form search-widget",id:"top-nav-search-form",role:"search",onSubmit:u=>u.preventDefault(),children:[e.jsx("label",{id:"top-nav-search-label",form:"top-nav-search-input",className:"visually-hidden",children:"Search MDD"}),e.jsx("input",{type:"search",value:t,onChange:k,onFocus:N,onBlur:D,placeholder:"   ",className:"search-input-field","aria-activedescendant":c?`top-nav-search-result-${c}`:void 0,"aria-expanded":r&&a.length>0?"true":"false","aria-autocomplete":"list","aria-controls":"top-nav-search-menu","aria-labelledby":"top-nav-search-label",autoComplete:"off",id:"top-nav-search-input",role:"combobox",name:"q"}),e.jsx("button",{type:"button",className:"button action has-icon clear-search-button",style:{display:t?"block":"none"},onClick:S,children:e.jsxs("span",{className:"button-wrap",children:[e.jsx("span",{className:"icon icon-cancel "}),e.jsx("span",{className:"visually-hidden",children:"Clear search input"})]})}),e.jsx("button",{type:"submit",className:`button action has-icon search-button ${a.length===0?"disabled":""}`,onClick:g,disabled:a.length===0,children:e.jsxs("span",{className:"button-wrap",children:[e.jsx("span",{className:"icon icon-search "}),e.jsx("span",{className:"visually-hidden",children:"Search"})]})}),e.jsx("div",{id:"top-nav-search-menu",role:"listbox","aria-labelledby":"top-nav-search-label",children:t&&e.jsx("div",{className:"search-results",children:l?e.jsx("div",{className:"result-item loading",children:e.jsx("a",{href:"",className:"loading",children:"加载中..."})}):a.length>0?a.map((u,d)=>{const v=W(u.matchedLine,t);return v?e.jsx("div",{role:"option","aria-selected":"false",id:`top-nav-search-result-${d}`,className:"result-item",children:e.jsxs("a",{href:u.filePath,tabIndex:-1,children:[e.jsx("b",{dangerouslySetInnerHTML:{__html:v}}),e.jsx("br",{}),e.jsx("small",{children:u.filePath})]})},d):null}):e.jsx("div",{className:"result-item nothing-found",children:e.jsx("a",{href:"",className:"no-result",children:"无结果"})})})})]})})},z=()=>{const[t,s]=h.useState(!0),[a,n]=h.useState(!1),l=H();h.useEffect(()=>{const c=window.matchMedia("(prefers-color-scheme: dark)");n(c.matches)},[]),h.useEffect(()=>{const c=document.getElementsByClassName("icon")[3];c&&(a?(document.documentElement.classList.remove("light"),document.documentElement.classList.add("dark"),c.classList.add("icon-theme-dark"),c.classList.remove("icon-theme-light")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"),c.classList.add("icon-theme-light"),c.classList.remove("icon-theme-dark")))},[a]),h.useEffect(()=>{const c=document.getElementsByClassName("top-navigation")[0];c&&(t?c.classList.remove("show-nav"):c.classList.add("show-nav"))},[t]);const i=()=>{s(!t)},r=()=>{n(!a)},o=c=>l.pathname===c||l.pathname===`${c}/`;return e.jsx("div",{className:"sticky-header-container without-actions",children:e.jsx("header",{className:"top-navigation",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"top-navigation-wrap",children:[e.jsxs(j,{to:"/",className:"logo","aria-label":"MOCDesignDOC home",children:[e.jsx(T,{className:"logo"}),e.jsx("span",{className:"logo-text",children:"MOCDesignDOCS"})]}),e.jsx("button",{title:t?"Close main menu":"Open main menu",type:"button",className:"button action has-icon main-menu-toggle","aria-expanded":t,onClick:i,children:e.jsxs("span",{className:"button-wrap",children:[e.jsx("span",{className:`icon ${t?"icon-menu":"icon-cancel"}`}),e.jsx("span",{className:"visually-hidden",children:t?"Close main menu":"Open main menu"})]})})]}),e.jsxs("div",{className:"top-navigation-main",children:[e.jsx("nav",{className:"main-nav",children:e.jsxs("ul",{className:"main-menu",children:[e.jsx("li",{className:"top-level-entry-container",children:e.jsx(j,{to:"/",className:"top-level-entry menu-link","aria-disabled":o("/"),children:"首页"})}),e.jsx("li",{className:"top-level-entry-container",children:e.jsx(j,{to:"/tutorials/快速开始",className:"top-level-entry menu-link","aria-disabled":o("/tutorials/教程"),children:"教程"})}),e.jsx("li",{className:"top-level-entry-container",children:e.jsx(j,{to:"/documents/开始之前",className:"top-level-entry menu-link","aria-disabled":o("/documents/文档"),children:"文档"})}),e.jsx("li",{className:"top-level-entry-container",children:e.jsx(j,{to:"/projects/纳新系列",className:"top-level-entry menu-link","aria-disabled":o("/projects/项目参考"),children:"项目参考"})}),e.jsx("li",{className:"top-level-entry-container",children:e.jsx(j,{to:"/about",className:"top-level-entry menu-link","aria-disabled":o("/about"),children:"关于"})})]})}),e.jsx(q,{}),e.jsx("div",{className:"theme-switcher-menu",children:e.jsx("button",{type:"button",className:"button action has-icon theme-switcher-menu small","aria-haspopup":"menu",onClick:r,children:e.jsxs("span",{className:"button-wrap",children:[e.jsx("span",{className:"theme-switcher-menu-icon icon"}),"色彩主题"]})})})]})]})})})},Q=z;export{Q as default};
